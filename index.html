<!DOCTYPE html>
<html>
	<head>
		<title>Dimensional Analysis</title>
    <link rel="icon" href="http://www.veryicon.com/icon/ico/Application/Long%20Shadow%20Media/Calculator.ico">
		<meta charset="utf-8">
  		<meta name="viewport" content="width=device-width, initial-scale=1">
  		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
  		<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
      <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&delayStartupUntil=configured">
      </script>
	</head>
	<body>
		<div class="text-center">
			<h1>Fes's Dimensional Analysis Learning Tool</h1>
			<p>This is a tool designed to teach dimensional analysis.</p>
		</div>

		<div class="container">
  			<h2>Units</h2>
  			<ul class="nav nav-tabs">
    			<li class="active"><a data-toggle="tab" href="#0">Length</a></li>
    			<li><a data-toggle="tab" href="#1">Area</a></li>
    			<li><a data-toggle="tab" href="#2">Volume</a></li>
    			<li><a data-toggle="tab" href="#3">Time</a></li>
    			<li><a data-toggle="tab" href="#4">Mass</a></li>
    			<li><a data-toggle="tab" href="#5">Force</a></li>
    			<li><a data-toggle="tab" href="#6">Pressure</a></li>
    			<li><a data-toggle="tab" href="#7">Energy</a></li>         
  			</ul>

  			<div class="tab-content">
    			<div id="0" class="tab-pane fade in active">
            <h4>SI Units</h4>
      			<ul class="SI">
            </ul>
            <h4>US Units</h4>
            <ul class="US">
            </ul>
            <h4>Other Units</h4>
            <ul class="other">
            </ul>
    			</div>
    		  <div id="1" class="tab-pane fade">
            <h4>SI Units</h4>
            <ul class="SI">
            </ul>
            <h4>US Units</h4>
            <ul class="US">
            </ul>
   			  </div>
    		  <div id="2" class="tab-pane fade">
    			 <h4>SI Units</h4>
           <ul class="SI">
           </ul>
           <h4>US Units</h4>
           <ul class="US">
           </ul>
    		  </div>
    		  <div id="3" class="tab-pane fade">
           <ul>
           </ul>
    		  </div>
    		  <div id="4" class="tab-pane fade">
            <h4>SI Units</h4>
            <ul class="SI">
            </ul>
            <h4>US Units</h4>
            <ul class="US">
            </ul>
            <h4>Other Units</h4>
            <ul class="other">
            </ul>
    	   	</div>
    	   	<div id="5" class="tab-pane fade">
            <h4>SI Units</h4>
            <ul class="SI">
            </ul>
            <h4>US Units</h4>
            <ul class="US">
            </ul>
    		  </div>
    		  <div id="6" class="tab-pane fade">
            <h4>SI Units</h4>
            <ul class="SI">
            </ul>
            <h4>Other Units</h4>
            <ul class="other">
            </ul>
    		  </div>
    		  <div id="7" class="tab-pane fade">
            <h4>SI Units</h4>
            <ul class="SI">
            </ul>
            <h4>US Units</h4>
            <ul class="US">
            </ul>
            <h4>Other Units</h4>
            <ul class="other">
            </ul>
    		  </div>
  		   </div>
         <br>
         <form class="form-inline">
          <fieldset>
              <div id="slide-wrap">
                  <div id="inner-wrap">
                      <div class="horizontal-fields" id="numerators">
                        <div class="numerator input-group textbox" id="num0">
                          <input type="number" name="value" class="form-control col-xs-2 num cell num-input" placeholder="Enter a value here">
                          <div class="input-group-addon" name="unit">Drag unit here</div>
                        </div>
                        <div class="btn btn-primary btn-sm multiply">x</div>
                        <div class="numerator input-group textbox" id="num1">
                          <input type="number" name="value" class="form-control col-xs-2 num cell num-input" placeholder="Enter a value here">
                          <div class="input-group-addon" name="unit">Drag unit here</div>
                        </div>
                        <div class="btn btn-primary btn-sm equals">=</div>
                        <div class="answer"></div>
                      </div>
                      <div class="horizontal-fields" id="denominators">
                        <div class="denominator input-group textbox" id="denom0">
                          <input type="number" name="value" class="form-control col-xs-2 num cell denom-input" placeholder="Enter a value here">
                          <div class="input-group-addon" name="unit">Drag unit here</div>
                        </div>
                        <div class="denominator input-group textbox tab" id="denom1">
                          <input type="number" name="value" class="form-control col-xs-2 num cell denom-input" placeholder= "Enter a value here">
                          <div class="input-group-addon" name="unit">Drag unit here</div>
                        </div>
                      </div>
                      <div class="horizontal-fields">
                        <button class="btn btn-primary btn-sm flip1" id="flip0" type="button" onclick="reverse(this.id)">&#8635</button>
                        <button class="btn btn-primary btn-sm flip" id="flip1" type="button" onclick="reverse(this.id)">&#8635</button>
                      </div>
                 </div>
              </div>
          </fieldset>
      </form>
      <div class="btn btn-primary btn-sm add">Add another multiplicand</div>
      <div class="btn btn-primary btn-sm compute">Compute</div>
      <footer class="text-center">© Jacob Kalodner and Ben Orgera 2016. All Rights Reserved. </footer>
	</body>
	<script type="text/javascript">
    var units = [
      [
        {"HTML":"m","cvt":1, "type":"SI"},
        {"HTML":"mm", "cvt:":0.001, "type":"SI"},
        {"HTML":"cm", "cvt":0.01, "type":"SI"},
        {"HTML":"dm", "cvt":0.1, "type":"SI"},
        {"HTML":"dam", "cvt":10, "type":"SI"},
        {"HTML":"hm", "cvt":100, "type":"SI"},
        {"HTML":"km", "cvt":1000, "type":"SI"},
        {"HTML":"in", "cvt":0.0254, "type":"US"},
        {"HTML":"ft", "cvt":0.3048, "type":"US"},
        {"HTML":"yd", "cvt":0.9144, "type":"US"},
        {"HTML":"mi", "cvt":1609.34, "type":"US"},
        {"HTML":"AU", "cvt":1.496e11, "type":"Other"},
        {"HTML":"ly", "cvt":9.461e15, "type":"Other"},
        {"HTML":"pc", "cvt":3.086e16, "type":"Other"},
        {"HTML":"ℓ<sub>P</sub>", "cvt":1.6e-35, "type":"Other"}
      ],

      [
        {"HTML":"m<sup>2</sup>", "cvt":1, "type":"SI"},
        {"HTML":"mm<sup>2</sup>", "cvt":0.000001, "type":"SI"},
        {"HTML":"cm<sup>2</sup>", "cvt":0.0001, "type":"SI"},
        {"HTML":"dm<sup>2</sup>", "cvt":0.01, "type":"SI"},
        {"HTML":"dam<sup>2</sup>", "cvt":100, "type":"SI"},
        {"HTML":"hm<sup>2</sup>", "cvt":10000, "type":"SI"},
        {"HTML":"km<sup>2</sup>", "cvt":1000000, "type":"SI"},
        {"HTML":"in<sup>2</sup>", "cvt":0.00064516, "type":"US"},
        {"HTML":"ft<sup>2</sup>", "cvt":0.09290304, "type":"US"},
        {"HTML":"yd<sup>2</sup>", "cvt":0.83612736, "type":"US"},
        {"HTML":"mi<sup>2</sup>", "cvt":2589988.110336, "type":"US"},
        {"HTML":"ac", "cvt":4046.8564224, "type":"Other"},
        {"HTML":"ha", "cvt":10000, "type":"Other"}
      ],
    
      [
        {"HTML":"L", "cvt":1, "type":"SI"},
        {"HTML":"mL", "cvt":0.001, "type":"SI"},
        {"HTML":"cL", "cvt":0.01, "type":"SI"},
        {"HTML":"dL", "cvt":0.1, "type":"SI"},
        {"HTML":"daL", "cvt":10, "type":"SI"},
        {"HTML":"hL", "cvt":100, "type":"SI"},
        {"HTML":"kL", "cvt":1000, "type":"SI"},
        {"HTML":"m<sup>3</sup>", "cvt":1000, "type":"SI"},
        {"HTML":"mm<sup>3</sup>", "cvt":1e-6, "type":"SI"},
        {"HTML":"cm<sup>3</sup>", "cvt":0.001, "type":"SI"},
        {"HTML":"dm<sup>3</sup>", "cvt":1, "type":"SI"},
        {"HTML":"dam<sup>3</sup>", "cvt":1000000, "type":"SI"},
        {"HTML":"hm<sup>3</sup>", "cvt":1000000000, "type":"SI"},
        {"HTML":"km<sup>3</sup>", "cvt":1000000000000, "type":"SI"},
        {"HTML":"gal<sub>SI</sub>", "cvt":4.54609, "type":"SI"},
        {"HTML":"pt<sub>SI</sub>", "cvt":0.56826125, "type":"SI"},
        {"HTML":"qt<sub>SI</sub>", "cvt":1.13652, "type":"SI"},
        {"HTML":"cup<sub>SI</sub>", "cvt":0.284131, "type":"SI"},
        {"HTML":"fl oz<sub>SI</sub>", "cvt":0.0284131, "type":"SI"},
        {"HTML":"in<sup>3</sup>", "cvt":0.016387064, "type":"US"},
        {"HTML":"ft<sup>3</sup>", "cvt":28.316846592, "type":"US"},
        {"HTML":"gal<sub>US</sub>", "cvt":3.785411784, "type":"US"},
        {"HTML":"pt<sub>US</sub>", "cvt":0.473176473, "type":"US"},
        {"HTML":"qt<sub>US</sub>", "cvt":0.946353, "type":"US"},
        {"HTML":"cup<sub>US</sub>", "cvt":0.236588, "type":"US"},
        {"HTML":"fl oz<sub>US</sub>", "cvt":0.0295735, "type":"US"}
      ],

      [
        {"HTML":"s", "cvt":1},
        {"HTML":"min", "cvt":60},
        {"HTML":"hr", "cvt":3600},
        {"HTML":"day", "cvt":86400},
        {"HTML":"week", "cvt":604800},
        {"HTML":"month", "cvt":2.6298e6},
        {"HTML":"year", "cvt":31557600},
        {"HTML":"decade", "cvt":315576000},
        {"HTML":"century", "cvt":3155760000},
        {"HTML":"millenium", "cvt":31557600000},
        {"HTML":"fortnight", "cvt":1209600},
        {"HTML":"t<sub>P</sub>", "cvt":5.39056e-44}
      ],

      [
        {"HTML":"g", "cvt":1, "type":"SI"},
        {"HTML":"mg", "cvt":0.001, "type":"SI"},
        {"HTML":"cg", "cvt":0.01, "type":"SI"},
        {"HTML":"dg", "cvt":0.1, "type":"SI"},
        {"HTML":"dag", "cvt":10, "type":"SI"},
        {"HTML":"hg", "cvt":100, "type":"SI"},
        {"HTML":"kg", "cvt":1000, "type":"SI"},
        {"HTML":"ton<sub>SI</sub>", "cvt":1000000, "type":"SI"},
        {"HTML":"ton<sub>US</sub>", "cvt":907184.74, "type":"US"},
        {"HTML":"oz", "cvt":28.35, "type":"US"},
        {"HTML":"sl", "cvt":14593.903, "type":"US"},
        {"HTML":"lb", "cvt":453.592, "type":"US"},
        {"HTML":"amu", "cvt":1.661e-24, "type":"Other"},
        {"HTML":"m<sub>P</sub>", "cvt":2.17645e-5, "type":"Other"}
      ],

      [
        {"HTML":"N", "cvt":1, "type":"SI"},
        {"HTML":"lb", "cvt":4.44822162825, "type":"US"},
        {"HTML":"F<sub>P</sub>", "cvt":1.21027e44, "type":"Other"}
      ],

      [
        {"HTML":"Pa", "cvt":1, "type":"SI"},
        {"HTML":"bar", "cvt":100000, "type":"Other"},
        {"HTML":"atm", "cvt":101325, "type":"Other"},
        {"HTML":"psi", "cvt":6894.757, "type":"Other"},
        {"HTML":"torr", "cvt":133.322, "type":"Other"}
      ],

      [
        {"HTML":"J", "cvt":1, "type":"SI"},
        {"HTML":"kJ", "cvt":1000, "type":"SI"},
        {"HTML":"ft·lb<sub>f</sub>", "cvt":1.356, "type":"US"}, 
        {"HTML":"btu", "cvt":1055.056, "type":"US"},
        {"HTML":"thm", "cvt":105480400, "type":"US"},
        {"HTML":"cal", "cvt":4.184, "type":"Other"},
        {"HTML":"kcal", "cvt":4184, "type":"Other"},
        {"HTML":"kWh", "cvt":3.6e6, "type":"Other"},
        {"HTML":"Wh", "cvt":3600, "type":"Other"},
        {"HTML":"eV", "cvt":1.6022e-19, "type":"Other"},
        {"HTML":"MeV", "cvt":1.6022e-13, "type":"Other"}
      ]
    ];

    var numOfFracs = 2;

    $(document).ready(function(){
      for(i=0;i<units.length;i++){ //loads all the buttons
        for(j=0;j<units[i].length;j++){
          var x="#"+i;
          var s = (typeof units[i][j].type != 'undefined' && units[i][j].type.length === 2) ? (' .' + units[i][j].type) : (units[i][j].type === "Other" ? ' .other' : ' ul');
          $(x+s).append('<li draggable="true" class="btn btn-primary btn-sm btns"></li>');
          $(x+' ul li').last().attr('id',units[i][j].HTML);
          $(x+' ul li').last().html(units[i][j].HTML);
          $('ul li').draggable({ //makes elements draggable
            revert: true,
            helper: 'clone'
          });
        }
      }

      $('.add').click(function(){ //adds multiplicands
        var numerator='<div class="btn btn-primary btn-sm multiply">x</div><div class="numerator input-group textbox" id="num' + numOfFracs + '"><input type="number" name="value" class="form-control col-xs-2 num cell num-input" placeholder="Enter a value here"><div class="input-group-addon" name="unit">Drag unit here</div></div>';
        var denominator='<div class="denominator tab input-group textbox tab" id="denom' + numOfFracs + '"><input type="number" name="value" class="form-control col-xs-2 num cell denom-input" placeholder="Enter a value here"><div class="input-group-addon" name="unit">Drag unit here</div></div>';
        var flip='<button class="btn btn-primary btn-sm flip textbox" id="flip' + numOfFracs + '" type="button" onclick="reverse(this.id)">&#8635</button>';
        $('.equals').before(numerator);
        $('.denominator').last().after(denominator);
        $('.flip').last().after(flip);
        $('.result div').each(function(){
          $(this).html("");
        });
        $('.result div').each(function(){
          $(this).html("");
        });

        $('.textbox').droppable({
          drop: function (event, ui) {
            $(this).find("[name='unit']").html($(ui.draggable).attr('id'));
          }
        });

        numOfFracs++;

      });

      $('.compute').click(function(){

        var product = 1;
        var numeratorUnits = [];
        var denominatorUnits = [];

        $('.num-input').each(function() {
          product *= $(this).val() ? $(this).val() : 1;
        });

        $('.denom-input').each(function() {
          product /= $(this).val() ? $(this).val() : 1;
        });

        $('.numerator div').each(function() {
          if ($(this).text() !== 'Drag unit here') numeratorUnits.push($(this).text());
        });

        $('.denominator div').each(function() {
          if ($(this).text() !== 'Drag unit here') denominatorUnits.push($(this).text());
        });


        for (var i = 0; i < numeratorUnits.length; i++) {
          for (var j = 0; j < denominatorUnits.length; j++) {
            if (numeratorUnits[i] === denominatorUnits[j]) {
              numeratorUnits.splice(i, 1);
              denominatorUnits.splice(j, 1);
              i--;
              j--;
            }    
          }
        }

        var numeratorString = '';
        var denominatorString = '';

        $(numeratorUnits).each(function() {
          numeratorString += '(' + this + ')';
        });

        $(denominatorUnits).each(function() {
          denominatorString += '(' + this + ')';
        });
        var ans= product + "\\(\\frac{" + numeratorString + "}{" +denominatorString + "}\\)";
        $('.answer').html(ans);
        MathJax.Hub.Configured();
       });
    });
    
    $('.num-input').on('change paste keyup drop', function() {
      var res = convert($(this).val(), $(this).parent().find('div').text(), $(getDenominator($(this).parent().attr('id'))).find('div').text());
      if (res) $(getDenominator($(this).parent().attr('id'))).find('input').val(res);
    });

    $('.denom-input').on('change paste keyup drop', function() {
      var res = convert($(this).val(), $(this).parent().find('div').text(), $(getNumerator($(this).parent().attr('id'))).find('div').text());
      if (res) $(getNumerator($(this).parent().attr('id'))).find('input').val(res);
    });

    $('.textbox').droppable({ //makes textboxes droppable
      drop: function (event, ui) {
         $(this).find("[name='unit']").html($(ui.draggable).attr('id'));
      }
    });

    function convert(unit1Val, unit1, unit2) {
      var unit1Pos = [];
      var unit2Pos = [];
      for (var i = 0; i < units.length; i++) {
        for (var j = 0; j < units[i].length; j++) {
          if (units[i][j].HTML === unit1) unit1Pos = [i, j];
          if (units[i][j].HTML === unit2) unit2Pos = [i, j];
        }
      }

      if (unit1Pos[0] !== unit2Pos[0]) return false; //non-convertible units

      return unit1Val * units[unit1Pos[0]][unit1Pos[1]].cvt / units[unit2Pos[0]][unit2Pos[1]].cvt;
    }

    function removeChars(string) {
      return string.replace(/\D/g,'');
    }

    function getNumerator(id) {
      id = removeChars(id);
      return $('#num' + id);
    }

    function getDenominator(id) {
      id = removeChars(id);
      return $('#denom' + id);
    }

    function reverse(id){
      var numerator = getNumerator(id);
      var denominator = getDenominator(id);

      var tempVal = $(numerator).find('input').val();
      var tempUnit = $(numerator).find('div').text();

      $(numerator).find('input').val($(denominator).find('input').val());
      $(denominator).find('input').val(tempVal);

      $(numerator).find('div').text($(denominator).find('div').text());
      $(denominator).find('div').text(tempUnit);
    }

	</script>
	<style type="text/css">
  input{
    width:148px;
  }
    ul{
      margin-top: 5px;
      padding-left: 0px;
    }
    li{
      margin-right: 4px;
      margin-top:5px;
    }
    .btns{
      cursor: move;
      z-index:1;
    }
    .cell{
      padding-bottom: 5px;
      margin-bottom: 5px;
      padding-left: 0px;
      padding-right: 0px;
      width:296px;
      position:static;
    }
    .numerator{
      border-bottom: 2px solid black;
      height:34px;
      width: 296px;
      display:inline-block;
      padding-bottom: 1px;
    }
    .denominator{
      height:34px;
      width: 296px;
      display:inline-block;
      margin-top: -12px;
    }
    .tab{
      margin-left:40px;
    }
    .multiply{
      margin-left:5px;
      margin-top:34px;
      margin-right:5px;
      position:static;
      cursor:auto;
      color:white;
      background-color: black;
      border-color: black;
      width:30px;
    }
    .multiply:hover{
      background-color:black;
      border-color: black;
    }
    .flip1{
      position: static;
      margin-left: 132px;
      width:30px;
    }
    .flip{
      position:static;
      margin-left: 306px;
      text-align:center;
      vertical-align: top;
      width:30px;
    }
    .add{
      margin-top:25px;
      display: block;
    }
    .compute{
      margin-top:10px;
      display: block; 
    }
    .equals{
      margin-top: 34px;
      margin-left: 5px;
      margin-right: 5px;
      position: static;
      cursor:auto;
      color:white;
      background-color: black;
      border-color: black;
      width:30px;
    }
    .equals:hover{
      background-color:black;
      border-color: black;
    }
    .answer{
      margin-top: 34px;
      margin-left: 5px;
      position:static;
      display: inline-block;
      font-size: 12px;
      vertical-align: middle;
    }
    #slide-wrap {
        margin:0;
        overflow: auto;
    }
    #inner-wrap {
        float:left;
        margin-right:-30000px;     
    }

    div.horizontal-fields input,
    div.horizontal-fields textarea,
    div.horizontal-fields select,
    div.horizontal-fields label {
        width: auto;
    }

    .horizontal-fields {
        display: block;
        font-size:0;
    }
	</style>
</html>